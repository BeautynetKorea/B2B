function dataInit(){let e=null;return $("form").serializeArray()}function getCartList(){cartList=getData("/order/cartList"),appendData($(".product-selected"),cartList,!0)}function setSubTotalPrice(){totalPriceResult=JSON.parse(totalPriceResult=getData("/order/cartTotalPrice")),$(".total-price").text(totalPriceResult.order_price_total),$(".discount-price").text(totalPriceResult.order_discount_total),$(".sub-total-price").text(totalPriceResult.order_subTotal)}function setCartSpq(e,a,t,r=!1){if(result=JSON.parse(result=getData("/order/editCartList",[{name:"cart_idx",value:e},{name:"order_qty",value:a},{name:"order_price",value:t}])),r)return result;200==result.Code&&setSubTotalPrice()}function compareMinMax(e,a,t){let r=e;return msg="",code=200,parseInt(e)>parseInt(a)&&(code=500,r=a,msg="주문 가능한 최대 수량은 "+a+"입니다"),parseInt(e)<parseInt(t)&&(code=500,r=t,msg="최소 주문 수량은 "+t+"입니다"),{code:code,data:r,msg:msg}}function validCheckSpq(e,a,t,r){return{code:200,data:e,msg:""}}function validRequiredCheck(e){null!=e&&e.find("input").each(function(){if(!0==$(this).prop("required")&&""==$(this).val()){$(this).addClass("text-danger");return}})}function addressFormInit(){$(".prev-addr-sel.selected").removeClass("selected"),$(".address-new-form input").val(""),$(".address-new-form select option:selected").prop("selected",!1)}$(document).ready(function(){$(document).on("click",".pagination a.page-link",function(e){e.preventDefault(),$("form [name='page']").val(parseInt($(this).data("page"))),productResult=getData("/order/productList",dataInit()),appendData($(".product-search-result"),productResult,!0)}),$(".brand-keyword-search").on("keyup",function(){let e,a,t,r,d="";a=(t=$(this)).val(),r=$(".brand-keyword-search-result"),a.length>0?(r.addClass("show"),""!=(e=getData("/api/getLikeBrandName",{brand_name:a}))?$.each(e,(e,a)=>{d+=`<li class='dropdown-item test' data-name='${a.brand_name}' data-id='${a.brand_id}'>${a.brand_name}</li>`}):d="<li class='dropdown-item'>No Data</li>",appendData(r,d,!0)):(r.removeClass("show"),r.empty(),r.append("<li class='dropdown-header'>Search for brands</li>"))}),$(document).on("click",".brand-keyword-search-result .dropdown-item",function(){let e=$(this).data("name"),a=""!=$('form [name="brand_id"]').val()?$('form [name="brand_id"]').val().split(","):[];$(".brand-list-group li").first().hasClass("active")&&$(".brand-list-group li").first().removeClass("active"),0>a.indexOf(String($(this).data("id")))&&(a.push($(this).data("id")),$(".brand-list-group").find("."+e).addClass("active"),$('form [name="brand_id"]').val(a),productResult=getData("/order/productList",dataInit()),appendData($(".product-search-result"),productResult,!0)),$(".brand-keyword-search").val(""),$(".brand-keyword-search-result").empty().append("<li class='dropdown-header'>Search for brands</li>")}),$(".brand-list-group .brand-item").on("click",function(){let e=$(this).data("id"),a=$('form [name="brand_id"]').val(),t=!1;$(this).index()>0?($(".brand-item.active").removeClass("active"),$(this).addClass("active"),0>a.indexOf(e)&&(a=e,t=!0)):a!=e?(t=!0,$(".brand-item").removeClass("active"),$(".brand-item").first().addClass("active"),a=""):t=!1,$('form [name="brand_id"]').val(a),t&&(console.log(dataInit()),productResult=getData("/order/productList",dataInit()),console.log(productResult),appendData($(".product-search-result"),productResult,!0))}),$("#productSearch").on("keyup",function(){dataInit();let e=$(this),a=$(".productSearchOpts option:selected").val(),t=e.val(),r=!1;if(t.length>1){if(""==a){$(".productSearchOpts").addClass("bg-danger text-white");return}$(".productSearchOpts").removeClass("bg-danger text-white"),r=!0}0==t.length&&(r=!0),r&&($('form [name="'+a+'"]').val(t),result=getData("/order/productList",dataInit()),appendData($(".product-search-result"),result,!0))}),$(".productSearchOpts").on("change",function(){let e=!1;$('form .key[name!="'+$(this).val()+'"]').val(""),$('form .key[name="'+$(this).val()+'"]').val($("#productSearch").val()),$(this).hasClass("bg-danger")&&$(this).removeClass("bg-danger text-white"),""!=$(this).val()&&""!=$("#productSearch").val()&&(e=!0),e&&(result=getData("/order/productList",dataInit()),appendData($(".product-search-result"),result,!0))}),$("#sampleCheck").on("click",function(){$("#sampleCheck").is(":checked")?$("form [name='sample']").val(1):$("form [name='sample']").val(""),result=getData("/order/productList",dataInit()),appendData($(".product-search-result"),result,!0)}),$(document).on("click",".order-req",function(){let e=$(this).parent().find("form").serializeArray();if(console.log("data ",e),"200"!=(_result=JSON.parse(result=getData("/order/addCartList",e))).Code)alert(_result.Msg);else{getCartList(),setSubTotalPrice();let a=""!=$(".product-search-result .bsk-del-btn:first").text()?$(".product-search-result .bsk-del-btn:first").text():"선택 취소";$(this).removeClass("order-req"),$(this).addClass("bsk-del-btn"),$(this).text(a),$(this).before("<input type='hidden' class='cart_idx' value='"+_result.Msg+"'>")}}),$(document).on("click",".increase-btn, .decrease-btn",function(){if($parents=$(this).parent().parent(),$parent=$(this).parent(),cartId=$parents.children(".cart_idx").val(),opVal=$parents.children(".op-val").val(),prdPrice=parseFloat($parents.children(".prd-price-val").val()),calcSpq=$parent.children(".qty-spq").val(),tempPrdTotPrice=parseFloat($parents.find("prd-total-price").val()),maxSpq=$parents.children(".qty-maximum-val").val(),standSpq=$parents.children(".qty-stand-val").val(),"-"==$(this).data("calc")){if(calcSpq==standSpq){alert("최소 수량입니다.");return}}else if("+"!=$(this).data("calc"))return;else if(calcSpq==maxSpq){alert("최대 수량입니다.");return}if(calcSpq=eval(calcSpq+$(this).data("calc")+opVal),$parent.find(".qty-spq").val(calcSpq),200!=(compare=compareMinMax(calcSpq,maxSpq,standSpq)).code&&($parent.find(".qty-spq").val(compare.data),calcSpq=$parent.find(".qty-spq").val()),tempPrdTotPrice=parseFloat(calcSpq*prdPrice),result=setCartSpq(cartId,calcSpq,tempPrdTotPrice,!0),console.log(result),200==result.Code)getCartList(),setSubTotalPrice();else{alert(result.Msg);return}}),$(document).on("click",".bsk-del-btn",function(){if(200==(result=JSON.parse(result=getData("/order/editCartList",[{name:"cart_idx",value:cartId=($parents=$(this).parent()).children(".cart_idx").val()},{name:"oper",value:"del"}]))).Code){if(getCartList(),setSubTotalPrice(),"undefined"!=$(this).data("order-req")){let e=""!=$(".product-search-result .order-req:first").text()?$(".product-search-result .order-req:first").text():"Choose";console.log("undefined"),$(this).removeClass("bsk-del-btn"),$(this).addClass("order-req"),$(this).text(e),$parents.children(".cart_idx").remove()}}else{alert(result.Msg);return}}),$(document).on("blur",".qty-spq",function(e){if(e.preventDefault(),$parent=$(this).parent().parent(),tempSpq=$(this).val(),standSpq=$parent.find(".qty-stand-val").val(),maxSpq=$parent.find(".qty-maximum-val").val(),operateVal=$parent.find(".op-val").val(),cartId=$parent.find(".cart_idx").val(),productPrice=$parent.find(".prd-price-val").val(),200!=(validChk=validCheckSpq(tempSpq,operateVal,standSpq,maxSpq)).code){alert(validChk.msg+"\n"+validChk.data+" 변경됨"),$(this).val(validChk.data);return}if(200!=(compare=compareMinMax(tempSpq,maxSpq,standSpq)).code){alert(compare.msg+"\n"+compare.data+" 변경됨"),$(this).val(compare.data);return}setCartSpq(cartId,$(this).val(),productPrice*$(this).val())}).on("keyup",".qty-spq",function(e){if(e.preventDefault(),$parent=$(this).parent().parent(),tempSpq=$(this).val(),standSpq=$parent.find(".qty-stand-val").val(),maxSpq=$parent.find(".qty-maximum-val").val(),operateVal=$parent.find(".op-val").val(),cartId=$parent.find(".cart_idx").val(),tempSpq.length>maxSpq.length||13==e.keyCode){if(200!=(compare=compareMinMax(tempSpq,maxSpq,standSpq)).code){alert(compare.msg);return}setCartSpq(cartId,$(this).val(),productPrice*$(this).val())}}),$(".pre-order-btn").on("click",function(){if((result=getData("/order/orderForm")).indexOf("error")>=0&&(result=JSON.parse(result),$.inArray("error",result))){alert(result.error);return}appendData($(".pre-order"),result,!0),$(".pre-order").show(),$("body").css("overflow","hidden"),$(".prev-addr-sel:first").click()}),$(".pre-order").on("click",function(e){$(e.target).attr("class")==$(this).attr("class")&&confirm("결제 취소하시겠습니까?")&&($(".pre-order").toggle(),$("body").css("overflow","auto"))}),$(document).on("click",".region-list .dropdown-item",function(){$(".regionSelected").val($(this).text()),$("[name=region_id]").val($(this).val()),$("[name=country_code]").val($(this).data("ccode")),$("[name=phone_code]").val($(this).data("cno"))}).on("keyup",".regionSelected",function(){$this=$(this),$regionList=$(".region-list > li"),!($this.val().length>1)||$this.hasClass("show")||($this.addClass("show"),$(".region-list").hasClass("show")||$(".region-list").addClass("show")),$searchedRegion=$regionList.filter(function(e){return $(this).text().toUpperCase().indexOf($this.val().toUpperCase())>-1}),$regionList.hide(),$searchedRegion.show()}).on("click",".checkout-btn",function(e){console.log("안내창 띄우기?"),""==$("[name=address_id]").val()&&$(".prev-addr-sel").length>0&&0==$(".prev-addr-sel.selected").length&&$("#address-prev-body").hasClass("show")&&(alert("주소를 선택하거나 입력해주세요"),e.preventDefault())}).on("click","#address-new-head .accordion-button",function(){""!=$("[name=address_id]").val()&&$(".prev-addr-sel.selected").length>0&&($("[name=address_id]").val(""),addressFormInit())}).on("click",".prev-addr-edit, .prev-addr-sel",function(e){addressFormInit(),$(this).hasClass("prev-addr-edit")&&$("#address-new-head .accordion-button").click(),$(this).hasClass("prev-addr-sel")&&($(".prev-addr-sel.selected").length>0&&$(".prev-addr-sel.selected").removeClass("selected"),$(this).addClass("selected")),$(".new-addr [name=address_id]").val($(this).data("id")),$(".new-addr [name=consignee]").val($(".prev-addr-sel.selected .consignee").text()),$(".new-addr [name=region]").val($(".prev-addr-sel.selected .region").text()),$(".new-addr [name=region_id]").val($(".prev-addr-sel.selected .region").data("id")),$(".new-addr [name=country_code]").val($(".prev-addr-sel.selected .region").data("ccode")),$(".new-addr [name=streetAddr1]").val($(".prev-addr-sel.selected .streetAddr1").text()),$(".new-addr [name=streetAddr2]").val($(".prev-addr-sel.selected .streetAddr2").text()),$(".new-addr [name=city]").val($(".prev-addr-sel.selected .city").text()),$(".new-addr [name=zipcode]").val($(".prev-addr-sel.selected .zipcode").text()),$(".new-addr [name=phone_code]").val($(".prev-addr-sel.selected .phone_code").text()),$(".new-addr [name=phone]").val($(".prev-addr-sel.selected .phone").text())}).on("click",".prev-addr-del",function(){alert((result=JSON.parse(result=getData("/order/addressOperate",[{name:"idx",value:$(this).data("id")},{name:"oper",value:"del"}]))).Msg),200==result.code&&($("[name=address_id]").val()==$(this).data("id")&&$("[name=address_id]").val(""),$(".prev-addr-sel").eq($(this).index()).remove(),0==$(".prev-addr-sel").length&&$("#address-new-head .accordion-button").click())}).on("click","#address-new-head .accordion-button",function(){"true"==$(this).attr("aria-expanded")?console.log("열림"):(console.log("닫힘"),$("#address-prev-head .accordion-button").click())}).on("click","[name=checkout-currency]",function(){let e=(result=JSON.parse(result=getData("/order/checkoutTotalPrice",[{name:"exchange",value:$(this).data("exchange")},{name:"rId",value:$(this).data("rid")}]))).order_price_total,a=result.order_discount_total,t=result.order_subTotal,r=result.applyDiscount;1==$(this).data("exchange")?($(".cart-total-price").addClass("KRW"),$(".currency-kr-tax-choice").show(),$("#payment-paypal").prop("checked")&&alert("페이팔 안됨"),$("#payment-paypal").prop("checked",!1).attr("disabled",!0)):($(".cart-total-price").removeClass("KRW"),$(".currency-kr-tax-choice").hide(),$("[name=taxation]:first").click(),$("#payment-bank2").prop("checked",!1).attr("disabled",!0),$("#payment-paypal").removeAttr("disabled")),$("[name=currency_code]").val($(this).data("code")),1!=r&&(a=0),t=e,$(".order-total-price").text($.numberWithCommas(e)),$(".order-discount-price").text($.numberWithCommas(a)),$(".order-subtotal-price").text($.numberWithCommas(t)),$("[name=order-total-price]").val(e),$("[name=order-discount-price]").val(a),$("[name=order-subtotal-price]").val(t)}).on("click","[name=taxation]",function(){let e=[{name:"exchange",value:$("[name=checkout-currency]:checked").data("exchange")},{name:"rId",value:$("[name=checkout-currency]:checked").data("rid")}],a;0==$(this).val()?(a=[{name:"onlyZeroTax",value:$(this).val()}],$("#payment-paypal").prop("checked",!1).attr("disabled",!0),$("#payment-bank1").prop("checked",!1).attr("disabled",!0),$("#payment-bank2").prop("checked",!0).attr("disabled",!1),alert("영세로만 판매되는 제품은 제외됨\n국내전용 계좌로만 입금 가능")):(a=[],$("#payment-bank1").removeAttr("disabled",!1));let t=(result=JSON.parse(result=getData("/order/checkoutTotalPrice",$.merge(e,a)))).order_price_total,r=result.order_discount_total,d=result.order_subTotal,s=result.applyDiscount,n=1.1;1!=s&&(r=0),d=t,0==$(this).val()?($(".only-zero-tax").addClass("bg-secondary bg-opacity-25"),$(".only-zero-tax .product-name").append('<span class="no-order-msg color-red fw-bold ms-1">주문불가</span>'),$(".order-total-price").text($.numberWithCommas(Math.ceil(t*n))),$(".order-discount-price").text($.numberWithCommas(Math.ceil(r*n))),$(".order-subtotal-price").text($.numberWithCommas(Math.ceil(d*n))),$("[name=order-total-price]").val(Math.ceil(t*n)),$("[name=order-discount-price]").val(Math.ceil(r*n)),$("[name=order-subtotal-price]").val(Math.ceil(d*n))):($(".only-zero-tax").removeClass("bg-secondary bg-opacity-25"),$(".no-order-msg").remove(),$(".order-total-price").text($.numberWithCommas(t)),$(".order-discount-price").text($.numberWithCommas(r)),$(".order-subtotal-price").text($.numberWithCommas(d)),$("[name=order-total-price]").val(t),$("[name=order-discount-price]").val(r),$("[name=order-subtotal-price]").val(d))})}),$(window).ready(function(){$(".prev-addr-sel:first").click()});